<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Register for the Healthcare Quality Grid — QuXAT QSAS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>
  <body>
    <script src="assets/js/storage.js"></script>
    <script src="assets/js/branding.js"></script>

    <header class="site-header">
      <div class="brand-bar container wide">
        <div class="brand-left">
          <img id="brandLogo" class="brand-logo" alt="QuXAT" src="assets/QuXAT%20Logo%20Facebook.png" />
          <div>
            <div class="brand-title">Register for the Healthcare Quality Grid</div>
            <div class="subtitle">Enter your organization details and selected guidelines</div>
          </div>
        </div>
      </div>
  </header>

    <section class="hero">
      <div class="hero-inner">
        <h1 class="hero-title">Join the QuXAT Healthcare Quality Grid</h1>
        <p class="hero-subtitle">Build visibility and trust by joining a quality‑centric global network of healthcare organizations. Network with peers, attract corporate clientele, and engage insurance providers through verified quality practices.</p>
        <div class="cta-row">
          <a href="#hqRegForm" class="btn btn-primary">Register Your Organization</a>
          <a href="#" class="btn" data-section="Healthcare Quality Grid">View Verified Organizations</a>
        </div>
      </div>
    </section>

    <main class="container wide">
      <section class="card">
        <h2>Healthcare Quality Grid Information Sheet</h2>
        <p class="hint">Select applicable guidelines and provide organization details. Admin will review and verify your submission before listing.</p>

        <form id="hqRegForm" class="form-grid">
          <label>
            Organization Name
            <input type="text" id="orgName" placeholder="e.g., City General Hospital" required />
          </label>
          <label>
            Organization Type
            <select id="orgType" required>
              <option value="">Select type</option>
              <option>Hospital</option>
              <option>Diagnostic Laboratory</option>
              <option>Pharmacy</option>
              <option>Dental Clinic</option>
              <option>Health Center</option>
              <option>Other Healthcare</option>
            </select>
          </label>
          <label>
            Representative Name
            <input type="text" id="repName" placeholder="Authorized representative" required />
          </label>
          <label>
            Designation
            <input type="text" id="repDesignation" placeholder="e.g., Quality Manager" required />
          </label>
          <label>
            Contact Email
            <input type="email" id="contactEmail" placeholder="name@example.com" required />
          </label>

          <div class="grid two">
            <label>
              Country
              <input type="text" id="orgCountry" placeholder="e.g., India" />
            </label>
            <label>
              State
              <input type="text" id="orgState" placeholder="e.g., Karnataka" />
            </label>
            <label>
              District
              <input type="text" id="orgDistrict" placeholder="e.g., Bengaluru Urban" />
            </label>
            <label>
              City / Town / Village
              <input type="text" id="orgCity" placeholder="e.g., Bengaluru" />
            </label>
          </div>

          <hr class="mt" />
          <h3>Quality</h3>
          <ul id="qualityList" class="list checklist"></ul>
          <h3>Safety</h3>
          <ul id="safetyList" class="list checklist"></ul>
          <h3>Compliance</h3>
          <ul id="complianceList" class="list checklist"></ul>

          <h3>Accreditations</h3>
          <ul id="accreditationsList" class="list checklist"></ul>

          <section class="card">
            <h3>Selected Guidelines Summary</h3>
            <div class="summary-grid">
              <div class="summary-card">
                <div class="summary-title">Selected</div>
                <div id="selCount" class="summary-value">0</div>
              </div>
              <div class="summary-card">
                <div class="summary-title">Score</div>
                <div id="selScore" class="summary-value">0</div>
              </div>
              <div class="summary-card">
                <div class="summary-title">Classification</div>
                <div id="selClass" class="summary-value">—</div>
              </div>
            </div>
            <div id="selSuggestions" class="card info" style="margin-top:12px;" hidden>
              <h3>Suggested Improvements</h3>
              <ul id="selSuggestionsList" class="list"></ul>
            </div>
            <div class="actions mt">
              <button type="button" id="resetSelBtn" class="btn">Reset Selection</button>
            </div>
          </section>

          <label class="full" style="display:flex; align-items:center; gap:8px;">
            <input type="checkbox" id="consent" />
            <span>I confirm the information is accurate and consent to listing after admin verification.</span>
          </label>
          <div class="actions">
            <button type="submit" class="btn btn-primary">Submit Registration</button>
          </div>
        </form>
        <div id="hqRegHint" class="hint">Your registration will appear on the Home page once approved.</div>
      </section>
    </main>

    <script>
      (function(){
        // Elements
        const hqRegForm = document.getElementById('hqRegForm');
        const orgTypeInput = document.getElementById('orgType');
        const orgNameInput = document.getElementById('orgName');
        const repNameInput = document.getElementById('repName');
        const repDesignationInput = document.getElementById('repDesignation');
        const contactEmailInput = document.getElementById('contactEmail');
        const orgCountryInput = document.getElementById('orgCountry');
        const orgStateInput = document.getElementById('orgState');
        const orgDistrictInput = document.getElementById('orgDistrict');
        const orgCityInput = document.getElementById('orgCity');
        const consentInput = document.getElementById('consent');
        const qualityList = document.getElementById('qualityList');
        const safetyList = document.getElementById('safetyList');
        const complianceList = document.getElementById('complianceList');
        const accreditationsList = document.getElementById('accreditationsList');
        const selCountEl = document.getElementById('selCount');
        const selScoreEl = document.getElementById('selScore');
        const selClassEl = document.getElementById('selClass');
        const selSugEl = document.getElementById('selSuggestions');
        const selSugList = document.getElementById('selSuggestionsList');
        const resetSelBtn = document.getElementById('resetSelBtn');

        // Base guidelines
        const qualityGuidelines = [
          { id: 'q1', text: 'Clinical governance and QMS documentation approved by leadership' },
          { id: 'q2', text: 'Evidence‑based clinical protocols standardized across departments' },
          { id: 'q3', text: 'Continuous clinical audit program with action tracking' },
          { id: 'q4', text: 'Patient feedback captured and reviewed; actions communicated' },
        ];
        const safetyGuidelines = [
          { id: 's1', text: 'Infection prevention & control program with surveillance indicators' },
          { id: 's2', text: 'Medication safety processes (prescribing, dispensing, administration)' },
          { id: 's3', text: 'Incident reporting and root‑cause analysis (RCA) performed' },
          { id: 's4', text: 'Staff training and competency checks on safety‑critical tasks' },
        ];
        const complianceGuidelines = [
          { id: 'c1', text: 'Licensing & statutory compliance current and documented' },
          { id: 'c2', text: 'Data protection and patient privacy compliance implemented' },
          { id: 'c3', text: 'Accreditation alignment (e.g., NABH/ISO) roadmap and gap log' },
          { id: 'c4', text: 'Emergency preparedness plan with regular drills' },
        ];

        const accreditationItems = [
          { id: 'acc_iso', text: 'ISO Accreditation (Healthcare relevant)' },
          { id: 'acc_nabh_entry', text: 'NABH Entry Level Accreditation' },
          { id: 'acc_nabh', text: 'NABH Accreditation' },
          { id: 'acc_nabl_entry', text: 'NABL Entry Level Accreditation' },
          { id: 'acc_nabl', text: 'NABL Accreditation' },
          { id: 'acc_jci', text: 'JCI Accreditation' },
        ];

        // Exclude non-relevant base items by organization type
        // Per request: Diagnostic Laboratory should not include clinical governance (q1)
        // and clinical audit programs (q3) from base Quality guidelines.
        const baseExclusions = {
          'Diagnostic Laboratory': {
            quality: new Set(['q1','q3']),
            // Add safety/compliance exclusions here if needed in future
          },
        };

        // Type‑specific items
        const typeGuidelines = {
          'Hospital': {
            override: true,
            quality: [
              { id: 'q_hosp_1', text: 'Surgical safety checklist compliance in all theatres' },
              { id: 'q_hosp_2', text: 'ICU clinical protocols and handover standards defined' },
              { id: 'q_hosp_3', text: 'Medication reconciliation and high‑risk drug controls implemented' },
              { id: 'q_hosp_4', text: 'Handover and escalation SOPs across wards' },
            ],
            safety: [
              { id: 's_hosp_1', text: 'Biomedical waste segregation and disposal audited' },
              { id: 's_hosp_2', text: 'Transfusion safety (blood bank) policies implemented' },
              { id: 's_hosp_3', text: 'Emergency codes (blue, red) drills and response documented' },
              { id: 's_hosp_4', text: 'Infection prevention surveillance with indicators' },
            ],
            compliance: [
              { id: 'c_hosp_1', text: 'Clinical establishment license and specialty approvals current' },
              { id: 'c_hosp_2', text: 'Radiology and anesthesia compliance (AERB/standards)' },
              { id: 'c_hosp_3', text: 'Patient privacy and data protection controls enforced' },
            ],
          },
          'Diagnostic Laboratory': {
            override: true,
            quality: [
              { id: 'q_lab_1', text: 'Internal QC logs reviewed and corrective actions tracked' },
              { id: 'q_lab_2', text: 'External proficiency testing participation results analyzed' },
              { id: 'q_lab_3', text: 'Calibration and maintenance of analyzers documented' },
              { id: 'q_lab_4', text: 'Result validation and critical value reporting SOPs' },
            ],
            safety: [
              { id: 's_lab_1', text: 'Specimen chain‑of‑custody documented end‑to‑end' },
              { id: 's_lab_2', text: 'Biohazard handling SOPs and PPE adherence monitored' },
              { id: 's_lab_3', text: 'Sharps safety and exposure incident management' },
              { id: 's_lab_4', text: 'Cold chain transport and storage logs maintained' },
            ],
            compliance: [
              { id: 'c_lab_1', text: 'Lab accreditation/recognition (e.g., NABL) roadmap maintained' },
              { id: 'c_lab_2', text: 'Reference ranges, LIS integrity, and access controls' },
            ],
          },
          'Pharmacy': {
            override: true,
            quality: [
              { id: 'q_pharm_1', text: 'Dispensing SOPs and counselling standards implemented' },
              { id: 'q_pharm_2', text: 'Medication reconciliation and patient counselling records' },
            ],
            safety: [
              { id: 's_pharm_1', text: 'Cold chain for temperature‑sensitive medicines monitored' },
              { id: 's_pharm_2', text: 'LASA (look‑alike/sound‑alike) labeling and separation' },
            ],
            compliance: [
              { id: 'c_pharm_1', text: 'Drug license and schedule compliance documented' },
              { id: 'c_pharm_2', text: 'Controlled substances registers and security' },
            ],
          },
          'Dental Clinic': {
            override: true,
            quality: [
              { id: 'q_dent_1', text: 'Clinical protocols for common procedures standardized' },
              { id: 'q_dent_2', text: 'Patient consent and documentation practices' },
            ],
            safety: [
              { id: 's_dent_1', text: 'Sterilization cycles logged; instrument tracking in place' },
              { id: 's_dent_2', text: 'Radiography safety and exposure monitoring implemented' },
              { id: 's_dent_3', text: 'Dental unit waterline disinfection schedule' },
            ],
            compliance: [
              { id: 'c_dent_1', text: 'Radiology equipment licensing and calibration records' },
              { id: 'c_dent_2', text: 'Biomedical waste disposal compliance' },
            ],
          },
          'Health Center': {
            override: true,
            quality: [
              { id: 'q_hc_1', text: 'Primary care pathways and referral protocols defined' },
              { id: 'q_hc_2', text: 'Maternal and child health program documentation' },
            ],
            safety: [
              { id: 's_hc_1', text: 'Vaccination cold chain compliance and monitoring' },
              { id: 's_hc_2', text: 'Emergency triage and stabilization SOPs' },
            ],
            compliance: [
              { id: 'c_hc_1', text: 'Community program documentation and regulatory reporting' },
              { id: 'c_hc_2', text: 'Pharmacy storage and expiry management within the center' },
            ],
          },
          'Other Healthcare': { override: false, quality: [], safety: [], compliance: [] }
        };

        function getActiveGuidelines(orgType){
          const type = String(orgType || '').trim();
          const extras = typeGuidelines[type] || typeGuidelines['Other Healthcare'];
          const ex = baseExclusions[type] || {};
          const baseQuality = Array.isArray(qualityGuidelines) ? qualityGuidelines.filter(it => !(ex.quality && ex.quality.has(it.id))) : [];
          const baseSafety = Array.isArray(safetyGuidelines) ? safetyGuidelines.filter(it => !(ex.safety && ex.safety.has(it.id))) : [];
          const baseCompliance = Array.isArray(complianceGuidelines) ? complianceGuidelines.filter(it => !(ex.compliance && ex.compliance.has(it.id))) : [];
          if (extras && extras.override) {
            return {
              quality: Array.isArray(extras.quality) ? extras.quality : [],
              safety: Array.isArray(extras.safety) ? extras.safety : [],
              compliance: Array.isArray(extras.compliance) ? extras.compliance : [],
            };
          }
          return {
            quality: [...baseQuality, ...((extras && extras.quality) || [])],
            safety: [...baseSafety, ...((extras && extras.safety) || [])],
            compliance: [...baseCompliance, ...((extras && extras.compliance) || [])],
          };
        }

        // Checklist UI
        function renderList(container, items){
          container.innerHTML = '';
          items.forEach(it => {
            const li = document.createElement('li');
            li.className = 'list-item';
            const label = document.createElement('label');
            label.style.display = 'flex';
            label.style.alignItems = 'center';
            label.style.gap = '10px';
          const cb = document.createElement('input');
          cb.type = 'checkbox';
          cb.dataset.itemId = it.id;
          cb.addEventListener('change', updateSummary);
          const span = document.createElement('span');
          span.textContent = it.text;
          label.append(cb, span);
          li.appendChild(label);
          container.appendChild(li);
        });
      }

        function renderAll(){
          const selected = String(orgTypeInput && orgTypeInput.value ? orgTypeInput.value : '').trim();
          const active = getActiveGuidelines(selected);
          renderList(qualityList, active.quality);
          renderList(safetyList, active.safety);
          renderList(complianceList, active.compliance);
          renderList(accreditationsList, accreditationItems);
        }

        try { orgTypeInput.addEventListener('change', renderAll); } catch(e) {}
        renderAll();

        function selectedIds() {
          return Array.from(document.querySelectorAll('input[type="checkbox"][data-item-id]'))
            .filter(cb => cb.checked)
            .map(cb => cb.dataset.itemId);
        }

        function updateSummary() {
          try {
            const selected = selectedIds();
            const type = String(orgTypeInput.value || '').trim();
            const active = getActiveGuidelines(type);
            const baseItems = [...active.quality, ...active.safety, ...active.compliance].map(it => ({ id: it.id, name: it.text }));
            const per = baseItems.length ? Math.round(100 / baseItems.length) : 0;
            const score = Math.round(selected.length * per);
            const cls = classifyScore(score, 100, { metrics: baseItems.map(it => ({ id: it.id, name: it.name, points: per })), selectedIds: selected });
            if (selCountEl) selCountEl.textContent = String(selected.length);
            if (selScoreEl) selScoreEl.textContent = String(score);
            if (selClassEl) selClassEl.textContent = cls.label || '—';
            if (Array.isArray(cls.suggestions) && cls.suggestions.length) {
              selSugEl.hidden = false;
              selSugList.innerHTML = '';
              cls.suggestions.slice(0, 8).forEach(s => {
                const li = document.createElement('li');
                li.textContent = s;
                selSugList.appendChild(li);
              });
            } else {
              selSugEl.hidden = true;
              selSugList.innerHTML = '';
            }
          } catch(e) {}
        }

        // Registration submit
        function perMetricFor(total){
          const maxPoints = 100; // distribute points evenly across selected guidelines
          const n = Math.max(1, Number(total || 0));
          return Math.round(maxPoints / n);
        }

        hqRegForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const orgName = orgNameInput.value.trim();
          const orgType = orgTypeInput.value.trim();
          const repName = repNameInput.value.trim();
          const repDesignation = repDesignationInput.value.trim();
          const email = contactEmailInput.value.trim();
          const consent = consentInput.checked;
          if (!consent) {
            return alert('Please provide consent to proceed with registration.');
          }
          if (!orgName || !orgType || !repName || !repDesignation || !email) {
            return alert('Please fill in all required fields.');
          }

          // Build metrics payload
          const active = getActiveGuidelines(orgType);
          const baseItems = [...active.quality, ...active.safety, ...active.compliance].map(it => ({ id: it.id, name: it.text }));
          const perMetric = perMetricFor(baseItems.length);
          const allItems = baseItems.map(it => ({ id: it.id, name: it.name, points: perMetric }));
          const selectedIdsArr = selectedIds();
          const selectedAccreditations = Array.from(accreditationsList.querySelectorAll('input[type="checkbox"]')).filter(cb => cb.checked).map(cb => cb.parentElement && cb.parentElement.querySelector('span') ? cb.parentElement.querySelector('span').textContent : '') .filter(Boolean);

          try {
            const payload = submitGridRegistration(allItems, selectedIdsArr, {
              orgName,
              orgType,
              repName,
              repDesignation,
              email,
              consent,
              accreditations: selectedAccreditations,
              orgCountry: String(orgCountryInput.value || ''),
              orgState: String(orgStateInput.value || ''),
              orgDistrict: String(orgDistrictInput.value || ''),
              orgCity: String(orgCityInput.value || ''),
            });
            alert('Registration submitted successfully. Admin will review and verify.');
            hqRegForm.reset();
            renderAll();
            updateSummary();
          } catch(err) {
            console.error(err);
            alert('Failed to submit registration. Please try again.');
          }
        });

        resetSelBtn?.addEventListener('click', () => {
          Array.from(document.querySelectorAll('input[type="checkbox"][data-item-id]')).forEach(cb => { cb.checked = false; });
          updateSummary();
        });

        consentInput?.addEventListener('change', () => {
          const btn = hqRegForm.querySelector('button[type="submit"]');
          if (btn) btn.disabled = !consentInput.checked;
        });
        const initBtn = hqRegForm.querySelector('button[type="submit"]');
        if (initBtn) initBtn.disabled = !consentInput.checked;
        updateSummary();
      })();
    </script>
  </body>
</html>
