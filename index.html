<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>QuXAT QSAS ‚Äî Ver 1 (7 Nov 2025)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>
  <body>
    <!-- Header added to place the QuXAT logo on Home -->
      <script>
      (function(){
        // Delegated handler so dynamically inserted buttons also open in new tab
        document.addEventListener('click', function(e){
          const a = e.target.closest('a[data-section]');
          if (!a) return;
          e.preventDefault();
          const s = a.dataset.section;
          const topWin = window.top || window.parent || window;
          const base = topWin.location.origin;
          const params = new URLSearchParams();
          params.set('section', s);
          if (a.dataset.category) params.set('category', a.dataset.category);
          if (a.dataset.checklist) params.set('checklist', a.dataset.checklist);
          const streamlitUrl = base + '/?' + params.toString();
          const port = String(topWin.location.port || '');
          const host = String(topWin.location.hostname || '');
          const isStreamlit = host.includes('streamlit') || ['8501','8502','8503','8504'].includes(port);
          if (isStreamlit) {
            // Open Streamlit section in a fresh tab
            try {
              const w = topWin.open(streamlitUrl, '_blank');
              if (w && typeof w.focus === 'function') w.focus();
            } catch(err) {
              try {
                const w2 = window.open(streamlitUrl, '_blank');
                if (w2 && typeof w2.focus === 'function') w2.focus();
              } catch(e) {}
            }
          } else {
            // Fallback to static pages when not embedded in Streamlit
            let fallback = a.getAttribute('href');
            if (!fallback || fallback === '#') {
              const sl = String(s || '').toLowerCase();
          // HQ Grid Admin removed
          if (sl.includes('register for the healthcare quality grid')) fallback = 'hq-register.html';
              else if (sl === 'admin' || (sl.includes('admin') && !sl.includes('hq'))) fallback = 'admin.html';
              else if (sl.includes('grid')) fallback = 'hq-grid.html';
              else if (sl.includes('home')) fallback = 'index.html';
              else fallback = 'user.html';
            }
            try {
              const w = topWin.open(fallback, '_blank');
              if (w && typeof w.focus === 'function') w.focus();
            } catch(e) {
              try {
                const w2 = window.open(fallback, '_blank');
                if (w2 && typeof w2.focus === 'function') w2.focus();
              } catch(_) {}
            }
          }
        });
        // Enforce new-tab behavior for any regular links without data-section
        const allLinks = document.querySelectorAll('a[href]');
        allLinks.forEach(a => {
          // Skip javascript:void(0) and anchors used as buttons without navigation
          if (!a.getAttribute('href')) return;
          if (a.getAttribute('href').startsWith('#')) return;
          a.setAttribute('target', '_blank');
          a.setAttribute('rel', 'noopener');
        });

      })();
      </script>

    <main class="container wide">
      <!-- Top brand logo above the hero banner -->
      <div style="text-align:center; margin:12px 0 0;">
        <img class="hero-logo" src="assets/QuXAT%20Logo%20Facebook.png" alt="QuXAT logo" />
      </div>
      <section class="hero">
        <div class="hero-inner">
          <h1 class="hero-title">QuXAT Self Assessment System (QSAS)</h1>
          <p class="hero-subtitle">A platform to conduct self assessment across Industries based on International Quality Standards &amp; Safety Guidelines</p>
        </div>
      </section>
      <section class="card info">
        <h3>About QSAS</h3>
        <p>
          QSAS (QuXAT Self‚ÄëAssessment System) helps organizations baseline their quality and safety practices against a standard quality and safety compliance checklist, compute a score, and receive targeted guidance to close gaps. It‚Äôs designed for conducting user based self assessment at schools, colleges, hospitals, industry, offices, and public organizations.
        </p>
        <p>
          On completion of self assessment an instant score and a maturity classification is provided to users. When ready, the self‚Äëassessment can be submitted for QSAS Admin verification to obtain a QSAS verified self assessment certificate.
        </p>
      </section>
      <section class="card">
        <h3>Quick Actions</h3>
        <div class="actions">
          <a href="#" class="btn btn-primary" data-section="User Assessment">Start Self Assessment</a>
          <a href="#" class="btn" data-section="Healthcare Quality Grid">Open Healthcare Quality Grid</a>
          <a href="#" class="btn" data-section="Register for the Healthcare Quality Grid">Register for Healthcare Quality Grid</a>
          <a href="#" class="btn" data-section="Admin">QSAS Admin Portal</a>
        </div>
      </section>
      <section class="card">
        <h3>Available Self Assessment Checklists</h3>
        <p class="hint">Browse by category and start your self assessment directly from the table.</p>
        <div class="table-wrap">
          <table id="checklistsTable" class="qsas-table" style="width:100%; border-collapse:collapse;">
            <thead>
              <tr>
                <th style="text-align:left; padding:8px; border-bottom:1px solid #e5e7eb;">Category</th>
                <th style="text-align:left; padding:8px; border-bottom:1px solid #e5e7eb;">Checklist</th>
                <th style="text-align:left; padding:8px; border-bottom:1px solid #e5e7eb;">Description</th>
                <th style="text-align:left; padding:8px; border-bottom:1px solid #e5e7eb;">Metrics</th>
                <th style="text-align:left; padding:8px; border-bottom:1px solid #e5e7eb;">Action</th>
              </tr>
            </thead>
            <tbody id="checklistsTbody"></tbody>
          </table>
        </div>
        <p id="publishedEmpty" class="empty" hidden>No published checklists yet. Create and publish them in the Admin portal.</p>
      </section>

      <!-- New: Aesthetic industry cards with checklist tiles -->
      <section class="card">
        <h3>Browse by Industry</h3>
        <p class="hint">Pick your industry and start with a relevant checklist.</p>
        <div id="industryCards" class="grid" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap:12px;"></div>
        <p id="industryEmpty" class="empty" hidden>No published checklists yet. Create and publish them in the Admin portal.</p>
      </section>

      <section class="card">
        <h3>At a Glance</h3>
        <div id="kpiGrid" class="kpi-grid"></div>
      </section>

      <section class="card">
        <h3>Healthcare Quality Grid ‚Äî Verified Organizations</h3>
        <p class="hint">Organizations verified by Admin and compliant with the Healthcare Quality Grid are listed here.</p>
        <div id="hqGridEmpty" class="empty" hidden>No verified organizations yet.</div>
        <div id="hqGridApproved" class="grid" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap:12px;"></div>
      </section>

      

      <section class="card">
        <h3>Benefits of Using QSAS</h3>
        <div class="grid" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:12px;">
          <div class="card info">
            <div class="item-title">üìè Standards Alignment</div>
            <div class="item-sub">Map practices to recognized quality and safety standards and internal SOPs.</div>
          </div>
          <div class="card info">
            <div class="item-title">üõ°Ô∏è Risk Visibility</div>
            <div class="item-sub">Surface safety risks early and prioritize gap closure with clear metrics.</div>
          </div>
          <div class="card info">
            <div class="item-title">üìÅ Audit‚ÄëReady Evidence</div>
            <div class="item-sub">Generate documented scoring and improvement actions for audits and inspections.</div>
          </div>
          <div class="card info">
            <div class="item-title">üîÑ Continuous Improvement</div>
            <div class="item-sub">Track progress with repeatable QSAS scores and targeted suggestions.</div>
          </div>
          <div class="card info">
            <div class="item-title">‚úÖ Self‚ÄëCertification Path</div>
            <div class="item-sub">Obtain a certified certificate upon Admin verification when you are ready.</div>
          </div>
          <div class="card info">
            <div class="item-title">‚è±Ô∏è Time‚ÄëEfficient</div>
            <div class="item-sub">Complete checklists quickly with Yes/No responses and instant scoring.</div>
          </div>
        </div>
      </section>
    </main>
    <!-- Moved brand bar to bottom of Home page -->
    <section class="card info container">
      <div class="brand-bar">
        <div class="brand-left">
          <img class="brand-logo" alt="QuXAT" src="assets/QuXAT%20Logo%20Facebook.png" />
          <div>
            <div class="brand-title">QuXAT QSAS ‚Äî Ver 1</div>
            <div class="subtitle">Quality &amp; Safety Self Assessment ‚Ä¢ 7 Nov 2025</div>
          </div>
        </div>
      </div>
    </section>

    <footer class="site-footer">
      <small>¬© QuXAT ‚Äî QSAS ‚Ä¢ <a href="https://quxat.com/" target="_blank" rel="noopener">Visit quxat.com</a></small>
    </footer>

    <script src="assets/js/storage.js"></script>
    <script src="assets/js/branding.js"></script>
      <script>
        (function(){
          const emptyEl = document.getElementById('publishedEmpty');
          const tableBody = document.getElementById('checklistsTbody');
          const cardsMount = document.getElementById('industryCards');
          const cardsEmpty = document.getElementById('industryEmpty');
          const kpiGrid = document.getElementById('kpiGrid');
          let lists = [];
          try { lists = (getChecklists() || []).filter(c => c.published !== false); } catch(e) { lists = []; }

        // Light pastel color per category for visual differentiation
        function categoryColor(cat) {
          const palette = [
            '#FFF7ED', // orange-50
            '#F0FDF4', // green-50
            '#F0F9FF', // sky-50
            '#FDF2F8', // pink-50
            '#F5F3FF', // violet-50
            '#EEF2FF', // indigo-50
            '#FEF2F2', // red-50
            '#ECFDF5', // emerald-50
            '#FFFBEB', // amber-50
            '#F1F5F9'  // slate-100
          ];
          if (!cat) return '#F1F5F9';
          let h = 0;
          const s = String(cat);
          for (let i = 0; i < s.length; i++) {
            h = (h * 31 + s.charCodeAt(i)) >>> 0;
          }
          return palette[Math.abs(h) % palette.length];
        }

        // Default supported categories (can generate checklists for these)
        const DEFAULT_CATEGORIES = [
          'Schools',
          'Colleges & Universities',
          'Hospitals & Healthcare',
          'Industrial & Manufacturing',
          'Offices & Corporate',
          'Public & Community Organizations',
        ];
        // Helper: derive category when missing (map Healthcare/Hospital to Hospitals & Healthcare)
        function normalizeCategoryLabel(raw) {
          const s = String(raw || '').toLowerCase();
          if (!s) return '';
          if (s.includes('hospital') || s.includes('healthcare')) return 'Hospitals & Healthcare';
          if (s.includes('school')) return 'Schools';
          if (s.includes('college') || s.includes('univer')) return 'Colleges & Universities';
          if (s.includes('industrial') || s.includes('manufactur')) return 'Industrial & Manufacturing';
          if (s.includes('office') || s.includes('corporate')) return 'Offices & Corporate';
          if (s.includes('public') || s.includes('community') || s.includes('organiza')) return 'Public & Community Organizations';
          return String(raw).trim();
        }

        function deriveCategory(c) {
          const existing = String(c?.category || '').trim();
          const derived = existing || String(c?.name || '');
          return normalizeCategoryLabel(derived);
        }

        // Build unique categories from defaults plus any published checklists (derived if missing)
        const categories = Array.from(new Set([
          ...DEFAULT_CATEGORIES,
          ...lists.map(deriveCategory).filter(Boolean),
        ]));

        function renderTable() {
          tableBody.innerHTML = '';
          if (!lists.length) {
            emptyEl.hidden = false;
            return;
          }
          emptyEl.hidden = true;
          // Group checklists by category
          const byCat = new Map();
          categories.forEach(cat => byCat.set(cat, []));
          lists.forEach(c => {
            const cat = deriveCategory(c) || 'Uncategorized';
            if (!byCat.has(cat)) byCat.set(cat, []);
            byCat.get(cat).push(c);
          });
          // Sort categories and items
          const sortedCats = Array.from(byCat.keys()).sort((a,b) => a.localeCompare(b));
          sortedCats.forEach(cat => {
            const items = (byCat.get(cat) || []).sort((a,b) => String(a.name).localeCompare(String(b.name)));
            if (items.length === 0) {
              const tr = document.createElement('tr');
              tr.style.background = categoryColor(cat);
              const tdCat = document.createElement('td'); tdCat.textContent = cat; tdCat.style.padding = '8px';
              const tdEmpty = document.createElement('td'); tdEmpty.colSpan = 4; tdEmpty.textContent = 'No checklists published for this category yet.'; tdEmpty.className = 'hint'; tdEmpty.style.padding = '8px';
              tr.append(tdCat, tdEmpty);
              tableBody.appendChild(tr);
              return;
            }
            items.forEach((c, idx) => {
              const tr = document.createElement('tr');
              tr.style.borderTop = '1px solid #eef1f6';
              tr.style.background = categoryColor(cat);
              const tdCat = document.createElement('td');
              tdCat.textContent = idx === 0 ? cat : '';
              tdCat.style.padding = '8px';
              tdCat.style.fontWeight = idx === 0 ? '600' : 'normal';
              const tdName = document.createElement('td'); tdName.style.padding = '8px'; tdName.textContent = `${c.code ? '[' + c.code + '] ' : ''}${c.name}`;
              const tdDesc = document.createElement('td'); tdDesc.style.padding = '8px'; tdDesc.textContent = c.description || '';
              const tdCount = document.createElement('td'); tdCount.style.padding = '8px';
              try { tdCount.textContent = String(Math.min((getMetrics(c.id) || []).length, 10)); } catch(e) { tdCount.textContent = '‚Äî'; }
              const tdAct = document.createElement('td'); tdAct.style.padding = '8px';
              const start = document.createElement('a');
              start.href = '#'; start.className = 'btn btn-primary'; start.textContent = 'Start Self Assessment';
              start.dataset.section = 'User Assessment';
              start.dataset.checklist = c.id;
              const catVal = deriveCategory(c);
              if (catVal) start.dataset.category = catVal;
              tdAct.appendChild(start);
              tr.append(tdCat, tdName, tdDesc, tdCount, tdAct);
              tableBody.appendChild(tr);
            });
          });
        }

          function renderCards() {
            if (!cardsMount) return;
            cardsMount.innerHTML = '';
            if (!lists.length) { cardsEmpty.hidden = false; return; }
            cardsEmpty.hidden = true;
            // Group and sort like the table
            const byCat = new Map();
            categories.forEach(cat => byCat.set(cat, []));
            lists.forEach(c => {
              const cat = deriveCategory(c) || 'Uncategorized';
              if (!byCat.has(cat)) byCat.set(cat, []);
              byCat.get(cat).push(c);
            });
            const sortedCats = Array.from(byCat.keys()).sort((a,b) => a.localeCompare(b));
            sortedCats.forEach(cat => {
              const items = (byCat.get(cat) || []).sort((a,b) => String(a.name).localeCompare(String(b.name)));
              const card = document.createElement('div');
              card.className = 'card info';
              card.style.background = categoryColor(cat);
              card.style.border = '1px solid #e5e7eb';
              const title = document.createElement('div');
              title.className = 'item-title';
              title.textContent = cat;
              const sub = document.createElement('div');
              sub.className = 'item-sub';
              sub.textContent = items.length ? `${items.length} checklist${items.length>1?'s':''} available` : 'No checklists yet';
              const actions = document.createElement('div');
              actions.className = 'actions';
              items.forEach(c => {
                const a = document.createElement('a');
                a.href = '#'; a.className = 'btn';
                a.textContent = c.name;
                a.dataset.section = 'User Assessment';
                a.dataset.checklist = c.id;
                a.dataset.category = cat;
                actions.appendChild(a);
              });
              card.append(title, sub, actions);
              cardsMount.appendChild(card);
            });
          }

          function renderKpis() {
            if (!kpiGrid) return;
            try {
              const published = lists.length;
              const catSet = new Set(lists.map(c => deriveCategory(c.category)).filter(Boolean));
              const industries = catSet.size;
              let approved = 0;
              try {
                approved = (typeof getApprovedGridRegistrations === 'function')
                  ? (getApprovedGridRegistrations() || []).length
                  : (getGridRegistrations() || []).filter(r => r.status === 'approved').length;
              } catch(e) { approved = 0; }
              const def = [
                { t: 'Published Checklists', v: String(published), s: 'Available for self assessment' },
                { t: 'Industries', v: String(industries || 0), s: 'Categories covered' },
                { t: 'Verified Organizations', v: String(approved || 0), s: 'Listed on Healthcare Quality Grid' },
              ];
              kpiGrid.innerHTML = '';
              def.forEach(k => {
                const d = document.createElement('div');
                d.className = 'kpi-card';
                const tt = document.createElement('div'); tt.className = 'kpi-title'; tt.textContent = k.t;
                const vv = document.createElement('div'); vv.className = 'kpi-value'; vv.textContent = k.v;
                const ss = document.createElement('div'); ss.className = 'kpi-sub'; ss.textContent = k.s;
                d.append(tt, vv, ss);
                kpiGrid.appendChild(d);
              });
            } catch(e) {}
          }

          renderTable();
          renderCards();
          renderKpis();
        })();
      (function(){
        // Render approved Healthcare Quality Grid organizations
        const mount = document.getElementById('hqGridApproved');
        const empty = document.getElementById('hqGridEmpty');
        let regs = [];
        try {
          regs = (typeof getApprovedGridRegistrations === 'function')
            ? getApprovedGridRegistrations()
            : (getGridRegistrations() || []).filter(r => r.status === 'approved');
        } catch(e) { regs = []; }
        if (!regs.length) { empty.hidden = false; return; }
        empty.hidden = true;
        regs.forEach(r => {
          const card = document.createElement('div');
          card.className = 'card info';
          const title = document.createElement('div');
          title.className = 'item-title';
          title.textContent = r.orgName || 'Organization';
          const sub = document.createElement('div');
          sub.className = 'item-sub';
          sub.textContent = `${r.orgType || 'Healthcare'} ‚Ä¢ Classification: ${r.classification || '-'} (${r.scorePercent ?? 0}%)`;
          const actions = document.createElement('div');
          actions.className = 'actions';
          const a = document.createElement('a');
          a.href = '#'; a.className = 'btn';
          a.textContent = 'View Grid Details';
          a.onclick = (e) => { e.preventDefault();
            const lines = (Array.isArray(r.selectedMetrics) ? r.selectedMetrics : []).map(m => `- ${m.name}`).join('\n');
            const sug = Array.isArray(r.suggestions) && r.suggestions.length ? `\nSuggested Improvements:\n${r.suggestions.map(x => `- ${x}`).join('\n')}\n` : '';
            const extra = [
              r.email ? `Contact Email: ${r.email}` : null,
              r.orgCountry ? `Country: ${r.orgCountry}` : null,
              r.orgState ? `State: ${r.orgState}` : null,
              r.orgDistrict ? `District: ${r.orgDistrict}` : null,
              r.orgCity ? `City/Town/Village: ${r.orgCity}` : null,
              r.repName ? `Representative: ${r.repName}` : null,
              r.repDesignation ? `Designation: ${r.repDesignation}` : null,
              Array.isArray(r.accreditations) && r.accreditations.length ? `Accreditations: ${r.accreditations.join(', ')}` : null,
            ].filter(Boolean).join('\n');
            alert(`${r.orgName || 'Organization'} ‚Ä¢ ${r.orgType || 'Healthcare'}\n${extra ? extra + '\n' : ''}${sug}\nSelected Guidelines:\n${lines}`);
          };
          actions.appendChild(a);
          card.append(title, sub, actions);
          mount.appendChild(card);
        });
      })();
    </script>
  </body>
  </html>
